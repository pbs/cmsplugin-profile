{% load i18n admin_static %}
{% spaceless %}
<div class="inline-group" id="{{ inline_admin_formset.formset.prefix }}-group">
{{ inline_admin_formset.formset.management_form }}
{{ inline_admin_formset.formset.non_form_errors }}
	<ul id='{{ inline_admin_formset.formset.prefix }}-group-grid'>

		{% for inline_admin_form in inline_admin_formset %}
		{% with form=inline_admin_form.form %}
		{% include "admin/profile/profile_form.html" %}
		{% endwith %}
		{% endfor %}
<a class="add-row " id="add_new_profile" href="javascript:void(0)">
<span class="add-btn ace-icon fa fa-plus" unselectable="on"></span>
<span class="add-text" unselectable="on">Add new profile</span>
</a>
</ul>
</div>

<script type="text/javascript">
(function($) {
	$(document).ready(function() {
		$("#add_new_profile").click(function(e) {
			children = $('#profile_set-group-grid li').children();
			jQuery.ajax({
				url: '/cmsplugin_profile/new_profile/'+(children.length - 1)+'/',
				success: function (response) {
					$('#profile_set-group-grid').append(response);
					total = $('#id_profile_set-TOTAL_FORMS')[0];
					total.value = parseInt(total.value) + 1;
				},
				error: function (response) {
				}
			});
		});
		$(document).on('click', '.add-profile-link', function(e) {
			link = e.currentTarget;
			prefix = link.attributes["data-prefix"].value;
			current = parseInt(link.attributes["data-current"].value);
			next_link = $("#"+prefix+current+"container")[0];
			if(next_link != undefined) {
				next_link.style.display="block";
				link.attributes["data-current"].value=current+1;
			}
		});

	})
})(jQuery || django.jQuery);
</script>


{% endspaceless %}
